#!/bin/sh

# the file where the commit message is written
filepath="$1"
tmp_file=$(mktemp /tmp/emoji-commitzen.XXXX)

replacements=(
    's/^new/âœ¨ Feat:/'
    's/^New/âœ¨ Feat:/'
    's/^add/âœ¨ Feat: add/'
    's/^Add/âœ¨ Feat: add/'
    's/^feat/âœ¨ Feat:/'
    's/^Feat/âœ¨ Feat:/'
    's/^fonc/âœ¨ Feat:/'
    's/^Fonc/âœ¨ Feat:/'
    's/^fix/ðŸ› Fix:/'
    's/^Fix/ðŸ› Fix:/'
    's/^doc/ðŸ“š Doc:/'
    's/^Doc/ðŸ“š Doc:/'
    's/^style/ðŸŽ¨ Style:/'
    's/^Style/ðŸŽ¨ Style:/'
    's/^compile/ðŸŽ¨ Style:/'
    's/^Compile/ðŸŽ¨ Style:/'
    's/^recompile/ðŸŽ¨ Style:/'
    's/^Recompile/ðŸŽ¨ Style:/'
    's/^format/ðŸ”¨ Refact:/'
    's/^Format/ðŸ”¨ Refact:/'
    's/^refacto/ðŸ”¨ Refact:/'
    's/^Refacto/ðŸ”¨ Refact:/'
    's/^update/ðŸ”¨ Refact:/'
    's/^Update/ðŸ”¨ Refact:/'
    's/^move/ðŸ”¨ Refact:/'
    's/^Move/ðŸ”¨ Refact:/'
    's/^perf/ðŸš€ Perf:/'
    's/^Perf/ðŸš€ Perf:/'
    's/^chore/ðŸ”§ Chore:/'
    's/^Chore/ðŸ”§ Chore:/'
    's/^config/ðŸ¤– CI:/'
    's/^Config/ðŸ¤– CI:/'
    's/^lint/ðŸ’„ Lint:/'
    's/^Lint/ðŸ’„ Lint:/'
    's/^test/ðŸ§ª Test:/'
    's/^Test/ðŸ§ª Test:/'
    's/^release/ðŸ“¦ Release:/'
    's/^Release/ðŸ“¦ Release:/'
    's/^first/ðŸ£ First:/'
    's/^First/ðŸ£ First:/'
    's/^remove/âŒ Del:/'
    's/^Remove/âŒ Del:/'
    's/^delete/âŒ Del:/'
    's/^Delete/âŒ Del:/'
    's/^revert/ðŸ” Revert:/'
    's/^Revert/ðŸ” Revert:/'
)

# join replacements by ; to have sed perform multiple replace
sed_command=$(printf "%s;" "${replacements[@]}")

# perform replacements in temp file
result=$(cat $filepath | sed "$sed_command")

# if there are brackets in the commit message, remove the colon
brackets_regex="\(([^()]*)\)"
for s in ${result[@]}; do
    if [[ ${s} =~ $brackets_regex ]]; then
        result=$(echo "$result" | sed "s/:(/(/")
    fi
done

# write result to temp file
echo $result > $tmp_file

# replace commit file
mv $tmp_file $filepath
